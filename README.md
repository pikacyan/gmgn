# GMGN 智能交易机器人

一个基于Telegram的智能加密货币交易机器人，专为BSC（币安智能链）设计。该机器人使用用户账号(Userbot)登录，能够自动监控合约地址、执行交易并进行智能风险管理。

## 🚀 核心功能

### 智能交易系统
- **自动合约验证**：多重验证机制确保合约地址有效性
- **智能买入执行**：接收合约地址后自动验证并执行买入
- **动态价格监控**：实时监控代币价格变化
- **智能止盈止损**：自动执行止盈和止损策略
- **交易重试机制**：失败交易自动重试，提高成功率

### 安全与风险控制
- **用户授权系统**：只允许授权用户发送交易指令
- **合约地址验证**：
  - BSCScan API验证合约存在性
  - DexScreener API验证交易对存在
  - 防止无效合约和诈骗合约
- **链上余额验证**：实时检查钱包余额确认交易状态
- **交易状态跟踪**：完整的交易生命周期管理

### 监控与通知
- **实时价格监控**：定期检查价格变化和涨跌幅
- **智能通知系统**：及时通知用户交易状态和价格变化
- **完整日志记录**：详细的操作日志和错误追踪
- **交易记录保存**：所有交易记录持久化存储

## 🏗️ 系统架构

### 核心组件

1. **ConfigManager** - 配置管理
   - 加载和验证配置文件
   - 提供默认配置和配置验证

2. **ContractValidator** - 合约验证器
   - BSCScan API合约验证
   - DexScreener交易对验证
   - 多重验证机制

3. **PriceMonitor** - 价格监控器
   - DexScreener价格获取
   - 实时价格变化监控

4. **BlockchainInteraction** - 区块链交互
   - 交易哈希查询
   - 代币余额检查
   - 合约地址提取

5. **TransactionManager** - 交易管理
   - 交易哈希提取
   - 交易记录保存
   - 交易状态跟踪

6. **BSCBot** - 主控制器
   - Telegram客户端管理
   - 消息处理和路由
   - 交易执行协调

## 📋 安装要求

- Python 3.7+
- 有效的Telegram账号
- BSCScan API密钥（推荐）
- 足够的BNB余额用于交易

## 🛠️ 安装步骤

1. **克隆仓库**
```bash
git clone https://github.com/yourusername/gmgn.git
cd gmgn
```

2. **安装依赖**
```bash
pip install -r requirements.txt
```

3. **配置设置**
```bash
cp config.yaml.example config.yaml
# 编辑config.yaml文件，填入必要的配置信息
```

## ⚙️ 配置说明

### 基础配置
```yaml
# Telegram API配置
api_id: YOUR_API_ID  # 从 https://my.telegram.org 获取
api_hash: "YOUR_API_HASH"  # 从 https://my.telegram.org 获取
phone: "+1234567890"  # 用于登录的电话号码

# 交易机器人配置
bot_username: "trading_bot_username"  # 交易机器人的用户名
bot_chat_id: 0  # 交易机器人的聊天ID（可选）

# 钱包配置
wallet_address: "0x1234567890abcdef1234567890abcdef12345678"  # 钱包地址
```

### 交易参数
```yaml
# 交易参数
buy_amount: "0.01"  # 买入金额（单位：BNB）
target_gain_percent: 50  # 止盈百分比
stop_loss_percent: 10  # 止损百分比

# 系统参数
price_check_interval: 30  # 价格检查间隔（秒）
buy_confirmation_delay: 5  # 买入确认延迟（秒）
max_transaction_retries: 3  # 最大交易重试次数
retry_delay: 5  # 重试间隔（秒）
```

### 安全配置
```yaml
# 授权用户ID列表
authorized_users:  # 用户ID可以通过 @userinfobot 获取
  - 123456789
  - 987654321

# BSCScan API密钥
bscscan_api_key: "YOUR_BSCSCAN_API_KEY"  # 从 https://bscscan.com/myapikey 获取
```

### 高级配置
```yaml
# 余额检查配置
check_balance_only_after_transaction: true  # 仅在交易后检查余额
```

## 🚀 使用方法

### 启动机器人
```bash
python app.py
```

### 基本操作流程

1. **首次启动**：输入Telegram验证码完成身份验证
2. **发送合约地址**：直接发送42位的合约地址（0x开头）
3. **自动验证**：机器人自动验证合约地址有效性
4. **执行买入**：验证通过后自动执行买入操作
5. **价格监控**：开始实时监控价格变化
6. **自动卖出**：达到止盈或止损条件时自动卖出

### 支持的消息格式
- 直接合约地址：`0x1234567890abcdef1234567890abcdef12345678`
- 只有授权用户发送的合约地址才会被处理

## 🔒 安全特性

### 多重验证机制
1. **用户授权验证**：只处理授权用户的消息
2. **合约地址验证**：
   - BSCScan API验证合约存在
   - DexScreener API验证交易对
   - 防止无效合约投资
3. **链上余额验证**：实时检查代币余额确认交易状态

### 风险控制
- **止盈止损**：自动执行风险管理策略
- **交易重试**：失败交易自动重试机制
- **超时清理**：自动清理超时的待处理交易
- **错误处理**：完善的异常处理和恢复机制

## 📊 监控与日志

### 日志系统
- **文件日志**：`gmgn_bot.log` - 完整的操作日志
- **控制台输出**：实时显示重要信息
- **日志级别**：INFO、WARNING、ERROR、CRITICAL

### 交易记录
- **记录文件**：`transactions.json` - 所有交易记录
- **记录内容**：时间戳、用户ID、合约地址、操作类型、价格、数量

### 监控指标
- 价格变化百分比
- 交易执行状态
- 余额验证结果
- 网络连接状态

## 🔧 高级功能

### 智能重连机制
- 自动检测网络断开
- 指数退避重连策略
- 最大重试次数限制

### 交易状态管理
- 待处理交易跟踪
- 交易超时自动清理
- 重试计数和限制

### 价格监控优化
- 多次重试获取价格
- 智能监控间隔调整
- 余额变化检测

## ⚠️ 注意事项

### 使用风险
- **Telegram政策**：使用用户账号(Userbot)可能违反Telegram服务条款
- **投资风险**：加密货币交易存在高风险，请谨慎投资
- **技术风险**：确保配置正确，定期检查运行状态

### 最佳实践
- **API密钥安全**：妥善保管API密钥，不要泄露
- **余额管理**：确保钱包有足够的BNB余额
- **定期监控**：定期检查日志文件和交易记录
- **配置备份**：备份重要的配置文件

### 系统要求
- 稳定的网络连接
- 足够的系统资源
- 有效的API密钥配置

## 🛠️ 故障排除

### 常见问题

1. **连接失败**
   - 检查API ID和API Hash是否正确
   - 确认网络连接正常
   - 验证电话号码格式

2. **合约验证失败**
   - 检查BSCScan API密钥是否有效
   - 确认合约地址格式正确
   - 验证合约是否真实存在

3. **交易失败**
   - 检查BNB余额是否充足
   - 确认交易机器人配置正确
   - 查看日志文件获取详细错误信息

4. **价格获取失败**
   - 检查网络连接
   - 确认DexScreener API可访问
   - 验证合约是否有交易对

### 日志分析
- 查看 `gmgn_bot.log` 获取详细错误信息
- 关注 WARNING 和 ERROR 级别的日志
- 检查交易记录文件确认交易状态

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 🤝 贡献

欢迎提交 Issue 和 Pull Request 来改进这个项目。

## ⚠️ 免责声明

本软件仅供学习和研究使用。使用本软件进行实际交易的风险由用户自行承担。开发者不对任何投资损失负责。请在使用前充分了解相关风险并谨慎操作。
